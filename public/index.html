<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quáº£n lÃ½ giÃ¡o viÃªn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-slate-800 text-white p-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
        <span>ğŸ“š</span> Chá»©c nÄƒng
      </h2>
      <nav class="flex flex-col gap-4">
        <button onclick="showSection('degrees')" class="bg-blue-500 hover:bg-blue-600 rounded py-2 px-4 text-center">Báº±ng cáº¥p</button>
        <button onclick="showSection('faculties')" class="bg-blue-500 hover:bg-blue-600 rounded py-2 px-4 text-center">Khoa</button>
        <button onclick="showSection('teachers')" class="bg-blue-500 hover:bg-blue-600 rounded py-2 px-4 text-center">GiÃ¡o viÃªn</button>
        <button onclick="showSection('statistics')" class="bg-blue-500 hover:bg-blue-600 rounded py-2 px-4 text-center">Thá»‘ng kÃª</button>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-8 space-y-8">
      <!-- ChÃ o má»«ng -->
      <section id="welcome" class="bg-white p-6 rounded shadow">
        <h2 class="text-3xl font-bold mb-6 text-center">ğŸ‰ ChÃ o má»«ng Ä‘áº¿n vá»›i Quáº£n lÃ½ GiÃ¡o viÃªn!</h2>
        <p class="text-center mb-4">ChÃºc báº¡n sá»­ dá»¥ng á»©ng dá»¥ng hiá»‡u quáº£. Vui lÃ²ng chá»n má»™t chá»©c nÄƒng tá»« menu bÃªn trÃ¡i Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
      </section>

      <!-- Báº±ng cáº¥p -->
      <section id="degrees" class="hidden bg-white p-6 rounded shadow relative">
        <h2 class="text-xl font-bold mb-4">ğŸ“ Danh sÃ¡ch báº±ng cáº¥p</h2>
        <button onclick="togglePopup('popupForm')" class="mb-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">â• ThÃªm má»›i</button>
        <table class="w-full text-left border">
          <thead>
            <tr class="bg-gray-100">
              <th class="border px-4 py-2">STT</th>
              <th class="border px-4 py-2">TÃªn Ä‘áº§y Ä‘á»§</th>
              <th class="border px-4 py-2">TÃªn viáº¿t táº¯t</th>
              <th class="border px-4 py-2">HÃ nh Ä‘á»™ng</th>
            </tr>
          </thead>
          <tbody id="degreeTable"></tbody>
        </table>

        <!-- Pop-up form -->
        <div id="popupForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">ThÃªm báº±ng cáº¥p</h3>
            <input id="degreeFullName" type="text" placeholder="TÃªn Ä‘áº§y Ä‘á»§" class="border p-2 w-full mb-2" />
            <input id="degreeShortName" type="text" placeholder="TÃªn viáº¿t táº¯t" class="border p-2 w-full mb-2" />
            <div class="flex justify-end gap-2">
              <button onclick="addDegree()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">ThÃªm</button>
              <button onclick="togglePopup('popupForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>

        <!-- Pop-up edit form -->
        <div id="popupEditForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">Sá»­a báº±ng cáº¥p</h3>
            <input id="editDegreeFullName" type="text" class="border p-2 w-full mb-2" />
            <input id="editDegreeShortName" type="text" class="border p-2 w-full mb-2" />
            <div class="flex justify-end gap-2">
              <button onclick="updateDegree()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">Cáº­p nháº­t</button>
              <button onclick="togglePopup('popupEditForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Khoa -->
      <section id="faculties" class="hidden bg-white p-6 rounded shadow relative">
        <h2 class="text-xl font-bold mb-4">ğŸ›ï¸ Danh sÃ¡ch khoa</h2>
        <button onclick="togglePopup('popupFacultyForm')" class="mb-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">â• ThÃªm má»›i</button>
        <table class="w-full text-left border">
          <thead>
            <tr class="bg-gray-100">
              <th class="border px-4 py-2">STT</th>
              <th class="border px-4 py-2">TÃªn Ä‘áº§y Ä‘á»§</th>
              <th class="border px-4 py-2">TÃªn viáº¿t táº¯t</th>
              <th class="border px-4 py-2">MÃ´ táº£</th>
              <th class="border px-4 py-2">HÃ nh Ä‘á»™ng</th>
            </tr>
          </thead>
          <tbody id="facultyTable"></tbody>
        </table>

        <!-- Pop-up form -->
        <div id="popupFacultyForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">ThÃªm khoa</h3>
            <input id="facultyFullName" type="text" placeholder="TÃªn Ä‘áº§y Ä‘á»§" class="border p-2 w-full mb-2" />
            <input id="facultyShortName" type="text" placeholder="TÃªn viáº¿t táº¯t" class="border p-2 w-full mb-2" />
            <textarea id="facultyDescription" placeholder="MÃ´ táº£" class="border p-2 w-full mb-2" rows="4"></textarea>
            <div class="flex justify-end gap-2">
              <button onclick="addFaculty()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">ThÃªm</button>
              <button onclick="togglePopup('popupFacultyForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>

        <!-- Pop-up edit form -->
        <div id="popupEditFacultyForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">Sá»­a khoa</h3>
            <input id="editFacultyFullName" type="text" class="border p-2 w-full mb-2" />
            <input id="editFacultyShortName" type="text" class="border p-2 w-full mb-2" />
            <textarea id="editFacultyDescription" class="border p-2 w-full mb-2" rows="4"></textarea>
            <div class="flex justify-end gap-2">
              <button onclick="updateFaculty()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">Cáº­p nháº­t</button>
              <button onclick="togglePopup('popupEditFacultyForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>
      </section>

      <!-- GiÃ¡o viÃªn -->
      <section id="teachers" class="hidden bg-white p-6 rounded shadow relative">
        <h2 class="text-xl font-bold mb-4">ğŸ‘©â€ğŸ« Danh sÃ¡ch giÃ¡o viÃªn</h2>
        <button onclick="togglePopup('popupTeacherForm')" class="mb-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">â• ThÃªm má»›i</button>
        <table class="w-full text-left border">
          <thead>
            <tr class="bg-gray-100">
              <th class="border px-4 py-2">STT</th>
              <th class="border px-4 py-2">MÃ£ GV</th>
              <th class="border px-4 py-2">Há» tÃªn</th>
              <th class="border px-4 py-2">NgÃ y Sinh</th>
              <th class="border px-4 py-2">Khoa</th>
              <th class="border px-4 py-2">Báº±ng cáº¥p</th>
              <th class="border px-4 py-2">HÃ nh Ä‘á»™ng</th>
            </tr>
          </thead>
          <tbody id="teacherTable"></tbody>
        </table>

        <!-- Pop-up form -->
        <div id="popupTeacherForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">ThÃªm giÃ¡o viÃªn</h3>
            <input id="teacherCode" type="text" placeholder="MÃ£ GV" class="border p-2 w-full mb-2" />
            <input id="teacherName" type="text" placeholder="Há» tÃªn" class="border p-2 w-full mb-2" />
            <input id="teacherBirthDate" type="date" placeholder="NgÃ y Sinh" class="border p-2 w-full mb-2" />
            <select id="teacherFaculty" class="border p-2 w-full mb-2">
              <option value="">Chá»n khoa</option>
            </select>
            <select id="teacherDegree" class="border p-2 w-full mb-2">
              <option value="">Chá»n báº±ng cáº¥p</option>
            </select>
            <div class="flex justify-end gap-2">
              <button onclick="addTeacher()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">ThÃªm</button>
              <button onclick="togglePopup('popupTeacherForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>

        <!-- Pop-up edit form -->
        <div id="popupEditTeacherForm" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-10">
          <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <h3 class="text-lg font-semibold mb-2">Sá»­a giÃ¡o viÃªn</h3>
            <input id="editTeacherCode" type="text" placeholder="MÃ£ GV" class="border p-2 w-full mb-2" />
            <input id="editTeacherName" type="text" placeholder="Há» tÃªn" class="border p-2 w-full mb-2" />
            <input id="editTeacherBirthDate" type="date" placeholder="NgÃ y Sinh" class="border p-2 w-full mb-2" />
            <select id="editTeacherFaculty" class="border p-2 w-full mb-2">
              <option value="">Chá»n khoa</option>
            </select>
            <select id="editTeacherDegree" class="border p-2 w-full mb-2">
              <option value="">Chá»n báº±ng cáº¥p</option>
            </select>
            <div class="flex justify-end gap-2">
              <button onclick="updateTeacher()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-green-600">Cáº­p nháº­t</button>
              <button onclick="togglePopup('popupEditTeacherForm')" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Huá»·</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Thá»‘ng kÃª -->
      <section id="statistics" class="hidden bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">ğŸ“Š Thá»‘ng kÃª giÃ¡o viÃªn</h2>
        <div class="mb-4">
          <label class="block mb-1">Lá»c theo khoa</label>
          <select id="facultyFilter" class="w-full border rounded p-2">
            <option value="">Táº¥t cáº£</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block mb-1">Lá»c theo báº±ng cáº¥p</label>
          <select id="degreeFilter" class="w-full border rounded p-2">
            <option value="">Táº¥t cáº£</option>
          </select>
        </div>
        <p class="font-semibold">Tá»•ng sá»‘ giÃ¡o viÃªn: <span id="teacherCount">0</span></p>
        <!-- Báº£ng hiá»ƒn thá»‹ giÃ¡o viÃªn Ä‘Æ°á»£c thá»‘ng kÃª -->
        <div class="mt-4">
          <h3 class="text-lg font-semibold mb-2">Danh sÃ¡ch giÃ¡o viÃªn Ä‘Æ°á»£c thá»‘ng kÃª</h3>
          <table class="w-full text-left border">
            <thead>
              <tr class="bg-gray-100">
                <th class="border px-4 py-2">STT</th>
                <th class="border px-4 py-2">MÃ£ GV</th>
                <th class="border px-4 py-2">Há» tÃªn</th>
                <th class="border px-4 py-2">NgÃ y Sinh</th>
                <th class="border px-4 py-2">Khoa</th>
                <th class="border px-4 py-2">Báº±ng cáº¥p</th>
              </tr>
            </thead>
            <tbody id="filteredTeacherTable"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script>
    let degrees = [];
    let faculties = [];
    let teachers = [];
    let editingDegreeId = null;
    let editingFacultyId = null;
    let editingTeacherId = null;

    function togglePopup(id) {
      document.getElementById(id).classList.toggle('hidden');
    }

    async function fetchData() {
      try {
        const [facultiesRes, degreesRes, teachersRes] = await Promise.all([
          axios.get('http://localhost:3000/api/faculties'),
          axios.get('http://localhost:3000/api/degrees'),
          axios.get('http://localhost:3000/api/teachers')
        ]);

        faculties = facultiesRes.data;
        degrees = degreesRes.data;
        teachers = teachersRes.data;

        // Log dá»¯ liá»‡u giÃ¡o viÃªn Ä‘á»ƒ kiá»ƒm tra cáº¥u trÃºc
        console.log('Dá»¯ liá»‡u giÃ¡o viÃªn tá»« API:', teachers);

        // Cáº­p nháº­t dropdown lá»c
        document.getElementById('facultyFilter').innerHTML = '<option value="">Táº¥t cáº£</option>' +
          faculties.map(f => `<option value="${f._id}">${f.fullName}</option>`).join('');
        document.getElementById('degreeFilter').innerHTML = '<option value="">Táº¥t cáº£</option>' +
          degrees.map(d => `<option value="${d._id}">${d.fullName}</option>`).join('');

        // Cáº­p nháº­t dropdown trong form thÃªm/sá»­a giÃ¡o viÃªn
        document.getElementById('teacherFaculty').innerHTML = '<option value="">Chá»n khoa</option>' +
          faculties.map(f => `<option value="${f._id}">${f.fullName}</option>`).join('');
        document.getElementById('teacherDegree').innerHTML = '<option value="">Chá»n báº±ng cáº¥p</option>' +
          degrees.map(d => `<option value="${d._id}">${d.fullName}</option>`).join('');
        document.getElementById('editTeacherFaculty').innerHTML = '<option value="">Chá»n khoa</option>' +
          faculties.map(f => `<option value="${f._id}">${f.fullName}</option>`).join('');
        document.getElementById('editTeacherDegree').innerHTML = '<option value="">Chá»n báº±ng cáº¥p</option>' +
          degrees.map(d => `<option value="${d._id}">${d.fullName}</option>`).join('');

        // Cáº­p nháº­t báº£ng khoa
        document.getElementById('facultyTable').innerHTML = faculties.map((f, i) => `
          <tr>
            <td class="border px-4 py-2">${i + 1}</td>
            <td class="border px-4 py-2">${f.fullName}</td>
            <td class="border px-4 py-2">${f.shortName}</td>
            <td class="border px-4 py-2">${f.description || ''}</td>
            <td class="border px-4 py-2 space-x-2">
              <button onclick="editFaculty('${f._id}')" class="text-blue-500 hover:underline">âœï¸</button>
              <button onclick="deleteFaculty('${f._id}')" class="text-red-500 hover:underline">ğŸ—‘ï¸</button>
            </td>
          </tr>`).join('');

        // Cáº­p nháº­t báº£ng báº±ng cáº¥p
        document.getElementById('degreeTable').innerHTML = degrees.map((d, i) => `
          <tr>
            <td class="border px-4 py-2">${i + 1}</td>
            <td class="border px-4 py-2">${d.fullName}</td>
            <td class="border px-4 py-2">${d.shortName}</td>
            <td class="border px-4 py-2 space-x-2">
              <button onclick="editDegree('${d._id}')" class="text-blue-500 hover:underline">âœï¸</button>
              <button onclick="deleteDegree('${d._id}')" class="text-red-500 hover:underline">ğŸ—‘ï¸</button>
            </td>
          </tr>`).join('');

        // Cáº­p nháº­t báº£ng giÃ¡o viÃªn
        document.getElementById('teacherTable').innerHTML = teachers.map((t, i) => {
          let formattedBirthDate = '';
          if (t.birthDate) {
            const birthDate = new Date(t.birthDate);
            formattedBirthDate = !isNaN(birthDate) ? birthDate.toLocaleDateString('vi-VN') : '';
          }
          return `
            <tr>
              <td class="border px-4 py-2">${i + 1}</td>
              <td class="border px-4 py-2">${t.code || ''}</td>
              <td class="border px-4 py-2">${t.name || ''}</td>
              <td class="border px-4 py-2">${formattedBirthDate}</td>
              <td class="border px-4 py-2">${t.facultyId?.fullName || ''}</td>
              <td class="border px-4 py-2">${t.degreeId?.fullName || ''}</td>
              <td class="border px-4 py-2 space-x-2">
                <button onclick="editTeacher('${t._id}')" class="text-blue-500 hover:underline">âœï¸</button>
                <button onclick="deleteTeacher('${t._id}')" class="text-red-500 hover:underline">ğŸ—‘ï¸</button>
              </td>
            </tr>`;
        }).join('');

        // Cáº­p nháº­t thá»‘ng kÃª
        updateCount();
      } catch (err) {
        console.error('Lá»—i khi láº¥y dá»¯ liá»‡u:', err);
        alert('KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i API.');
      }
    }

    function showSection(id) {
      ['welcome', 'degrees', 'faculties', 'teachers', 'statistics'].forEach(sectionId => {
        document.getElementById(sectionId).classList.add('hidden');
      });
      document.getElementById(id).classList.remove('hidden');
      if (id !== 'welcome') {
        fetchData(); // Gá»i fetchData() khi chuyá»ƒn sang cÃ¡c section khÃ¡c ngoÃ i "welcome"
      }
    }

    // Degree Functions
    async function addDegree() {
      const fullName = document.getElementById('degreeFullName').value;
      const shortName = document.getElementById('degreeShortName').value;
      if (!fullName || !shortName) return alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin');
      try {
        await axios.post('http://localhost:3000/api/degrees', { fullName, shortName });
        document.getElementById('degreeFullName').value = '';
        document.getElementById('degreeShortName').value = '';
        togglePopup('popupForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi thÃªm báº±ng cáº¥p');
        console.error(err);
      }
    }

    async function deleteDegree(id) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
      try {
        await axios.delete(`http://localhost:3000/api/degrees/${id}`);
        fetchData();
      } catch (err) {
        alert('Lá»—i khi xÃ³a báº±ng cáº¥p');
        console.error(err);
      }
    }

    function editDegree(id) {
      const degree = degrees.find(d => d._id === id);
      if (!degree) return;
      editingDegreeId = id;
      document.getElementById('editDegreeFullName').value = degree.fullName;
      document.getElementById('editDegreeShortName').value = degree.shortName;
      togglePopup('popupEditForm');
    }

    async function updateDegree() {
      const fullName = document.getElementById('editDegreeFullName').value;
      const shortName = document.getElementById('editDegreeShortName').value;
      try {
        await axios.put(`http://localhost:3000/api/degrees/${editingDegreeId}`, { fullName, shortName });
        togglePopup('popupEditForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi cáº­p nháº­t báº±ng cáº¥p');
        console.error(err);
      }
    }

    // Faculty Functions
    async function addFaculty() {
      const fullName = document.getElementById('facultyFullName').value;
      const shortName = document.getElementById('facultyShortName').value;
      const description = document.getElementById('facultyDescription').value;
      if (!fullName || !shortName) return alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ TÃªn Ä‘áº§y Ä‘á»§ vÃ  TÃªn viáº¿t táº¯t');
      try {
        await axios.post('http://localhost:3000/api/faculties', { fullName, shortName, description });
        document.getElementById('facultyFullName').value = '';
        document.getElementById('facultyShortName').value = '';
        document.getElementById('facultyDescription').value = '';
        togglePopup('popupFacultyForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi thÃªm khoa');
        console.error(err);
      }
    }

    async function deleteFaculty(id) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
      try {
        await axios.delete(`http://localhost:3000/api/faculties/${id}`);
        fetchData();
      } catch (err) {
        alert('Lá»—i khi xÃ³a khoa');
        console.error(err);
      }
    }

    function editFaculty(id) {
      const faculty = faculties.find(f => f._id === id);
      if (!faculty) return;
      editingFacultyId = id;
      document.getElementById('editFacultyFullName').value = faculty.fullName;
      document.getElementById('editFacultyShortName').value = faculty.shortName;
      document.getElementById('editFacultyDescription').value = faculty.description || '';
      togglePopup('popupEditFacultyForm');
    }

    async function updateFaculty() {
      const fullName = document.getElementById('editFacultyFullName').value;
      const shortName = document.getElementById('editFacultyShortName').value;
      const description = document.getElementById('editFacultyDescription').value;
      try {
        await axios.put(`http://localhost:3000/api/faculties/${editingFacultyId}`, { fullName, shortName, description });
        togglePopup('popupEditFacultyForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi cáº­p nháº­t khoa');
        console.error(err);
      }
    }

    // Teacher Functions
    async function addTeacher() {
      const code = document.getElementById('teacherCode').value;
      const name = document.getElementById('teacherName').value;
      const birthDate = document.getElementById('teacherBirthDate').value;
      const facultyId = document.getElementById('teacherFaculty').value;
      const degreeId = document.getElementById('teacherDegree').value;
      if (!code || !name || !birthDate || !facultyId || !degreeId) {
        return alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin');
      }
      try {
        console.log('Dá»¯ liá»‡u gá»­i lÃªn API:', { code, name, birthDate, facultyId, degreeId });
        await axios.post('http://localhost:3000/api/teachers', { code, name, birthDate, facultyId, degreeId });
        document.getElementById('teacherCode').value = '';
        document.getElementById('teacherName').value = '';
        document.getElementById('teacherBirthDate').value = '';
        document.getElementById('teacherFaculty').value = '';
        document.getElementById('teacherDegree').value = '';
        togglePopup('popupTeacherForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi thÃªm giÃ¡o viÃªn: ' + (err.response?.data?.message || err.message));
        console.error(err);
      }
    }

    async function deleteTeacher(id) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?')) return;
      try {
        await axios.delete(`http://localhost:3000/api/teachers/${id}`);
        fetchData();
      } catch (err) {
        alert('Lá»—i khi xÃ³a giÃ¡o viÃªn');
        console.error(err);
      }
    }

    function editTeacher(id) {
      const teacher = teachers.find(t => t._id === id);
      if (!teacher) {
        alert('KhÃ´ng tÃ¬m tháº¥y giÃ¡o viÃªn');
        return;
      }
      editingTeacherId = id;
      document.getElementById('editTeacherCode').value = teacher.code || '';
      document.getElementById('editTeacherName').value = teacher.name || '';
      document.getElementById('editTeacherBirthDate').value = teacher.birthDate ? new Date(teacher.birthDate).toISOString().split('T')[0] : '';
      document.getElementById('editTeacherFaculty').value = teacher.facultyId?._id || '';
      document.getElementById('editTeacherDegree').value = teacher.degreeId?._id || '';
      togglePopup('popupEditTeacherForm');
    }

    async function updateTeacher() {
      const code = document.getElementById('editTeacherCode').value;
      const name = document.getElementById('editTeacherName').value;
      const birthDate = document.getElementById('editTeacherBirthDate').value;
      const facultyId = document.getElementById('editTeacherFaculty').value;
      const degreeId = document.getElementById('editTeacherDegree').value;
      if (!code || !name || !birthDate || !facultyId || !degreeId) {
        return alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin');
      }
      try {
        console.log('Dá»¯ liá»‡u cáº­p nháº­t gá»­i lÃªn API:', { code, name, birthDate, facultyId, degreeId });
        await axios.put(`http://localhost:3000/api/teachers/${editingTeacherId}`, { code, name, birthDate, facultyId, degreeId });
        togglePopup('popupEditTeacherForm');
        fetchData();
      } catch (err) {
        alert('Lá»—i khi cáº­p nháº­t giÃ¡o viÃªn: ' + (err.response?.data?.message || err.message));
        console.error(err);
      }
    }

    function updateCount() {
      const facultyFilter = document.getElementById('facultyFilter');
      const degreeFilter = document.getElementById('degreeFilter');
      const teacherCount = document.getElementById('teacherCount');
      const filteredTeacherTable = document.getElementById('filteredTeacherTable');

      const selectedFaculty = facultyFilter.value;
      const selectedDegree = degreeFilter.value;
      const filtered = teachers.filter(t => {
        const matchFaculty = !selectedFaculty || t.facultyId?._id === selectedFaculty;
        const matchDegree = !selectedDegree || t.degreeId?._id === selectedDegree;
        return matchFaculty && matchDegree;
      });

      // Cáº­p nháº­t tá»•ng sá»‘ giÃ¡o viÃªn
      teacherCount.textContent = filtered.length;

      // Cáº­p nháº­t báº£ng danh sÃ¡ch giÃ¡o viÃªn Ä‘Æ°á»£c lá»c
      filteredTeacherTable.innerHTML = filtered.map((t, i) => {
        let formattedBirthDate = '';
        if (t.birthDate) {
          const birthDate = new Date(t.birthDate);
          formattedBirthDate = !isNaN(birthDate) ? birthDate.toLocaleDateString('vi-VN') : '';
        }
        return `
          <tr>
            <td class="border px-4 py-2">${i + 1}</td>
            <td class="border px-4 py-2">${t.code || ''}</td>
            <td class="border px-4 py-2">${t.name || ''}</td>
            <td class="border px-4 py-2">${formattedBirthDate}</td>
            <td class="border px-4 py-2">${t.facultyId?.fullName || ''}</td>
            <td class="border px-4 py-2">${t.degreeId?.fullName || ''}</td>
          </tr>`;
      }).join('');
    }

    // ThÃªm event listener cho dropdown
    document.getElementById('facultyFilter').addEventListener('change', updateCount);
    document.getElementById('degreeFilter').addEventListener('change', updateCount);

    fetchData();
    showSection('welcome'); // Hiá»ƒn thá»‹ "ChÃ o má»«ng" khi trang táº£i
  </script>
</body>
</html>